- name: download kataribe
  get_url:
    url: https://github.com/matsuu/kataribe/releases/download/v0.4.2/kataribe-v0.4.2_linux_amd64.zip
    checksum: sha1:f915678c43b68398263ea5a6e5950042cd9dc317
    dest: /tmp/kataribe.zip
  register: kataribe

- block:
    - name: install kataribe
      unarchive:
        remote_src: yes
        src: /tmp/kataribe.zip
        dest: /usr/local/bin
    - name: delete unused files
      file:
        path: /usr/local/bin/{{ item }}
        state: absent
      loop:
        - LICENSE
        - README.md
        - kataribe.toml
  when: kataribe.changed

- name: put configuration
  copy:
    src: kataribe.toml
    dest: /etc/kataribe.toml
    mode: 0644
